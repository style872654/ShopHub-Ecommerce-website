<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Dashboard - ShopHub E-Commerce</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <style>
    :root {
      --primary-color: #3b82f6;
      --secondary-color: #10b981;
      --accent-color: #f59e0b;
      --danger-color: #ef4444;
    }
    .btn-primary {
      background-color: var(--primary-color);
      color: white;
      font-weight: 600;
      padding: 0.5rem 1rem;
      border-radius: 0.375rem;
      transition: all 0.3s;
    }
    .btn-primary:hover {
      background-color: #2563eb;
    }
    .btn-success {
      background-color: var(--secondary-color);
      color: white;
      font-weight: 600;
      padding: 0.5rem 1rem;
      border-radius: 0.375rem;
      transition: all 0.3s;
    }
    .btn-success:hover {
      background-color: #059669;
    }
    .btn-danger {
      background-color: var(--danger-color);
      color: white;
      font-weight: 600;
      padding: 0.5rem 1rem;
      border-radius: 0.375rem;
      transition: all 0.3s;
    }
    .btn-danger:hover {
      background-color: #dc2626;
    }
    .container-custom {
      max-width: 80rem;
      margin-left: auto;
      margin-right: auto;
      padding-left: 1rem;
      padding-right: 1rem;
    }
    @media (min-width: 640px) {
      .container-custom {
        padding-left: 1.5rem;
        padding-right: 1.5rem;
      }
    }
    @media (min-width: 1024px) {
      .container-custom {
        padding-left: 2rem;
        padding-right: 2rem;
      }
    }
    .section-title {
      font-size: 1.5rem;
      font-weight: 700;
      margin-bottom: 1.5rem;
      color: #1f2937;
    }
    .animate-fade-in {
      animation: fadeIn 0.5s ease-in;
    }
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    .input-field {
      width: 100%;
      padding: 0.75rem 1rem;
      border: 1px solid #e5e7eb;
      border-radius: 0.375rem;
      font-size: 0.875rem;
      transition: all 0.3s;
    }
    .input-field:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.3);
    }
    .card {
      background-color: white;
      border-radius: 0.5rem;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
      overflow: hidden;
    }
    .tab-active {
      background-color: var(--primary-color);
      color: white;
      border-color: var(--primary-color);
    }
    .tab {
      padding: 0.75rem 1.5rem;
      font-weight: 500;
      transition: all 0.3s;
      border-radius: 0.375rem;
      border: 1px solid #e5e7eb;
    }
    .tab:hover:not(.tab-active) {
      background-color: #f9fafb;
      border-color: #d1d5db;
    }
    .modal {
      display: none;
      position: fixed;
      z-index: 100;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgba(0,0,0,0.5);
    }
    .modal-content {
      background-color: #fefefe;
      margin: 2% auto;
      padding: 20px;
      border-radius: 8px;
      max-width: 600px;
      width: 90%;
      box-shadow: 0 5px 15px rgba(0,0,0,0.3);
    }
  </style>
</head>
<body class="bg-gray-100">
  <!-- Header -->
  <header class="sticky top-0 z-50 bg-white shadow-md py-4">
    <div class="container-custom">
      <div class="flex items-center justify-between">
        <!-- Logo -->
        <a href="index.html" class="text-2xl font-bold text-blue-600">
          ShopHub <span class="text-gray-600 text-xl">Admin</span>
        </a>
        
        <!-- Connection Status -->
        <div id="connection-status" class="hidden text-sm px-2 py-1 rounded-md"></div>
        
        <!-- Quick Actions -->
        <div class="flex items-center space-x-4">
          <a href="shop.html" class="text-gray-600 hover:text-blue-600 transition" title="View Shop">
            <i class="fas fa-store text-xl"></i>
          </a>
          <a href="account.html" class="text-gray-600 hover:text-blue-600 transition" title="Account">
            <i class="fas fa-user text-xl"></i>
          </a>
          <button id="signOutButton" class="text-gray-600 hover:text-red-600 transition" title="Sign Out">
            <i class="fas fa-sign-out-alt text-xl"></i>
          </button>
        </div>
      </div>
    </div>
  </header>

  <main class="container-custom py-8 animate-fade-in">
    <!-- Admin Dashboard -->
    <div class="flex flex-col md:flex-row gap-8">
      <!-- Sidebar Navigation -->
      <div class="md:w-1/4 lg:w-1/5">
        <div class="bg-white rounded-lg shadow-sm p-4 sticky top-24">
          <div class="space-y-2">
            <button id="dashboard-tab" class="w-full text-left tab">
              <i class="fas fa-tachometer-alt mr-2"></i> Dashboard
            </button>
            <button id="products-tab" class="w-full text-left tab tab-active">
              <i class="fas fa-box mr-2"></i> Products
            </button>
            <button id="orders-tab" class="w-full text-left tab">
              <i class="fas fa-shopping-cart mr-2"></i> Orders
            </button>
            <button id="customers-tab" class="w-full text-left tab">
              <i class="fas fa-users mr-2"></i> Customers
            </button>
            <button id="categories-tab" class="w-full text-left tab">
              <i class="fas fa-tags mr-2"></i> Categories
            </button>
            <button id="settings-tab" class="w-full text-left tab">
              <i class="fas fa-cog mr-2"></i> Settings
            </button>
          </div>
        </div>
      </div>
      
      <!-- Main Content Area -->
      <div class="md:w-3/4 lg:w-4/5">
        <!-- Products Tab Content -->
        <div id="products-content" class="tab-content">
          <div class="bg-white rounded-lg shadow-sm p-6 mb-6">
            <div class="flex justify-between items-center mb-6">
              <h2 class="text-xl font-semibold">Product Management</h2>
              <button id="add-product-btn" class="btn-primary">
                <i class="fas fa-plus mr-2"></i> Add New Product
              </button>
            </div>
            
            <div class="mb-4">
              <div class="flex flex-col md:flex-row md:items-center gap-4">
                <div class="flex-grow">
                  <input type="text" id="search-products" placeholder="Search products..." class="input-field">
                </div>
                <div class="flex gap-2">
                  <select id="filter-category" class="input-field">
                    <option value="">All Categories</option>
                    <option value="electronics">Electronics</option>
                    <option value="clothing">Clothing</option>
                    <option value="home">Home & Kitchen</option>
                    <option value="beauty">Beauty</option>
                    <option value="sports">Sports</option>
                    <option value="books">Books</option>
                  </select>
                  <select id="sort-products" class="input-field">
                    <option value="name-asc">Name (A-Z)</option>
                    <option value="name-desc">Name (Z-A)</option>
                    <option value="price-asc">Price (Low to High)</option>
                    <option value="price-desc">Price (High to Low)</option>
                    <option value="date-desc">Newest First</option>
                    <option value="date-asc">Oldest First</option>
                  </select>
                </div>
              </div>
            </div>
            
            <div class="overflow-x-auto">
              <table class="min-w-full divide-y divide-gray-200">
                <thead>
                  <tr>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Product</th>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">SKU</th>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Category</th>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Price</th>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Stock</th>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                  </tr>
                </thead>
                <tbody id="products-list" class="bg-white divide-y divide-gray-200">
                  <!-- Products will be populated here via JavaScript -->
                </tbody>
              </table>
            </div>
            
            <div id="no-products" class="hidden text-center py-8">
              <i class="fas fa-box-open text-gray-400 text-5xl mb-3"></i>
              <p class="text-gray-500">No products found. Try a different search or add a new product.</p>
            </div>
            
            <div class="mt-6 flex justify-between items-center">
              <div class="text-sm text-gray-500">
                Showing <span id="showing-count">0</span> of <span id="total-count">0</span> products
              </div>
              <div class="flex space-x-2">
                <button id="prev-page" class="px-3 py-1 border border-gray-300 rounded-md text-sm" disabled>
                  <i class="fas fa-chevron-left mr-1"></i> Previous
                </button>
                <button id="next-page" class="px-3 py-1 border border-gray-300 rounded-md text-sm" disabled>
                  Next <i class="fas fa-chevron-right ml-1"></i>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>
  
  <!-- Add/Edit Product Modal -->
  <div id="product-modal" class="modal">
    <div class="modal-content">
      <div class="flex justify-between items-center mb-6">
        <h3 id="modal-title" class="text-xl font-semibold">Add New Product</h3>
        <button id="close-modal" class="text-gray-500 hover:text-gray-700">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <form id="product-form">
        <input type="hidden" id="product-id">
        
        <div class="mb-4">
          <label for="product-name" class="block text-sm font-medium text-gray-700 mb-1">Product Name *</label>
          <input type="text" id="product-name" class="input-field" required>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
          <div>
            <label for="product-sku" class="block text-sm font-medium text-gray-700 mb-1">SKU</label>
            <input type="text" id="product-sku" class="input-field">
          </div>
          <div>
            <label for="product-price" class="block text-sm font-medium text-gray-700 mb-1">Price ($) *</label>
            <input type="number" id="product-price" class="input-field" min="0" step="0.01" required>
          </div>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
          <div>
            <label for="product-category" class="block text-sm font-medium text-gray-700 mb-1">Category *</label>
            <select id="product-category" class="input-field" required>
              <option value="">Select Category</option>
              <option value="electronics">Electronics</option>
              <option value="clothing">Clothing</option>
              <option value="home">Home & Kitchen</option>
              <option value="beauty">Beauty</option>
              <option value="sports">Sports</option>
              <option value="books">Books</option>
            </select>
          </div>
          <div>
            <label for="product-stock" class="block text-sm font-medium text-gray-700 mb-1">Stock *</label>
            <input type="number" id="product-stock" class="input-field" min="0" required>
          </div>
          <div>
            <label for="product-status" class="block text-sm font-medium text-gray-700 mb-1">Status</label>
            <select id="product-status" class="input-field">
              <option value="active">Active</option>
              <option value="draft">Draft</option>
              <option value="out-of-stock">Out of Stock</option>
            </select>
          </div>
        </div>
        
        <div class="mb-4">
          <label for="product-image" class="block text-sm font-medium text-gray-700 mb-1">Image URL *</label>
          <input type="url" id="product-image" class="input-field" required>
        </div>
        
        <div class="mb-4">
          <label for="product-description" class="block text-sm font-medium text-gray-700 mb-1">Description</label>
          <textarea id="product-description" rows="4" class="input-field resize-none"></textarea>
        </div>
        
        <div class="flex justify-end space-x-3 mt-6">
          <button type="button" id="cancel-product" class="px-4 py-2 border border-gray-300 rounded-md">
            Cancel
          </button>
          <button type="submit" class="btn-primary" id="save-product">
            Save Product
          </button>
        </div>
      </form>
    </div>
  </div>
  
  <!-- Delete Confirmation Modal -->
  <div id="delete-modal" class="modal">
    <div class="modal-content max-w-md">
      <div class="text-center mb-6">
        <div class="bg-red-100 mx-auto rounded-full w-16 h-16 flex items-center justify-center mb-4">
          <i class="fas fa-exclamation-triangle text-red-600 text-2xl"></i>
        </div>
        <h3 class="text-xl font-semibold text-gray-900">Delete Product</h3>
        <p class="text-gray-600 mt-2">Are you sure you want to delete this product? This action cannot be undone.</p>
      </div>
      
      <div class="flex justify-center space-x-3">
        <button type="button" id="cancel-delete" class="px-4 py-2 border border-gray-300 rounded-md">
          Cancel
        </button>
        <button type="button" id="confirm-delete" class="btn-danger">
          Delete
        </button>
      </div>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // API URL (adjust based on your server configuration)
      const API_URL = 'api';
      
      // Tab navigation
      const tabButtons = document.querySelectorAll('.tab');
      const tabContents = document.querySelectorAll('.tab-content');
      
      tabButtons.forEach(button => {
        button.addEventListener('click', function() {
          // Remove active class from all tabs
          tabButtons.forEach(btn => btn.classList.remove('tab-active'));
          // Add active class to clicked tab
          this.classList.add('tab-active');
          
          // Hide all tab contents
          tabContents.forEach(content => content.style.display = 'none');
          
          // Show the corresponding tab content
          const contentId = this.id.replace('-tab', '-content');
          document.getElementById(contentId).style.display = 'block';
        });
      });
      
      // Modal elements
      const productModal = document.getElementById('product-modal');
      const deleteModal = document.getElementById('delete-modal');
      const addProductBtn = document.getElementById('add-product-btn');
      const closeModalBtn = document.getElementById('close-modal');
      const cancelProductBtn = document.getElementById('cancel-product');
      const cancelDeleteBtn = document.getElementById('cancel-delete');
      const productForm = document.getElementById('product-form');
      const modalTitle = document.getElementById('modal-title');
      const saveProductBtn = document.getElementById('save-product');
      const confirmDeleteBtn = document.getElementById('confirm-delete');
      
      // Product list and pagination
      const productsList = document.getElementById('products-list');
      const noProducts = document.getElementById('no-products');
      const prevPageBtn = document.getElementById('prev-page');
      const nextPageBtn = document.getElementById('next-page');
      const showingCount = document.getElementById('showing-count');
      const totalCount = document.getElementById('total-count');
      
      // Filters and search
      const searchInput = document.getElementById('search-products');
      const categoryFilter = document.getElementById('filter-category');
      const sortSelect = document.getElementById('sort-products');
      
      // Form fields
      const productId = document.getElementById('product-id');
      const productName = document.getElementById('product-name');
      const productSku = document.getElementById('product-sku');
      const productPrice = document.getElementById('product-price');
      const productCategory = document.getElementById('product-category');
      const productStock = document.getElementById('product-stock');
      const productStatus = document.getElementById('product-status');
      const productImage = document.getElementById('product-image');
      const productDescription = document.getElementById('product-description');
      
      // Pagination state
      let currentPage = 1;
      const itemsPerPage = 10;
      let selectedProductId = null;
      
      // Format currency
      function formatCurrency(amount) {
        return '$' + parseFloat(amount).toFixed(2);
      }
      
      // Handle API errors
      function handleApiError(error) {
        console.error('API Error:', error);
        let errorMessage = 'An error occurred. Please try again later.';
        
        if (error.response) {
          // Server responded with a status code outside the 2xx range
          errorMessage = `Server error: ${error.response.status} - ${error.response.data.message || 'Unknown error'}`;
        } else if (error.request) {
          // Request was made but no response was received
          errorMessage = 'Server not responding. Please check your network connection.';
        } else {
          // Something happened in setting up the request
          errorMessage = `Request error: ${error.message}`;
        }
        
        alert(errorMessage);
      }
      
      // Fetch products from the API
      async function fetchProducts() {
        try {
          const searchTerm = searchInput.value;
          const category = categoryFilter.value;
          const sort = sortSelect.value;
          
          const queryParams = new URLSearchParams({
            page: currentPage,
            limit: itemsPerPage
          });
          
          if (searchTerm) queryParams.append('search', searchTerm);
          if (category) queryParams.append('category', category);
          if (sort) queryParams.append('sort', sort);
          
          try {
            const response = await fetch(`${API_URL}/products?${queryParams.toString()}`);
            if (!response.ok) throw new Error(`Server responded with status: ${response.status}`);
            
            const data = await response.json();
            return data;
          } catch (apiError) {
            console.error('API Error:', apiError);
            console.log('Falling back to localStorage data');
            
            // Fallback to localStorage when API is unavailable
            const products = JSON.parse(localStorage.getItem('shophub_products')) || [];
            
            // Filter products based on search term
            let filtered = products;
            if (searchTerm) {
              const term = searchTerm.toLowerCase();
              filtered = filtered.filter(p => 
                p.name.toLowerCase().includes(term) ||
                (p.sku && p.sku.toLowerCase().includes(term)) ||
                (p.description && p.description.toLowerCase().includes(term))
              );
            }
            
            // Filter by category
            if (category) {
              filtered = filtered.filter(p => p.category === category);
            }
            
            // Apply sorting
            if (sort) {
              switch (sort) {
                case 'name-asc':
                  filtered.sort((a, b) => a.name.localeCompare(b.name));
                  break;
                case 'name-desc':
                  filtered.sort((a, b) => b.name.localeCompare(a.name));
                  break;
                case 'price-asc':
                  filtered.sort((a, b) => a.price - b.price);
                  break;
                case 'price-desc':
                  filtered.sort((a, b) => b.price - a.price);
                  break;
                case 'date-desc':
                  filtered.sort((a, b) => (b.createdAt || 0) - (a.createdAt || 0));
                  break;
                case 'date-asc':
                  filtered.sort((a, b) => (a.createdAt || 0) - (b.createdAt || 0));
                  break;
              }
            }
            
            // Apply pagination
            const totalProducts = filtered.length;
            const start = (currentPage - 1) * itemsPerPage;
            const end = start + itemsPerPage;
            const paginatedProducts = filtered.slice(start, end);
            
            return {
              products: paginatedProducts,
              totalProducts: totalProducts,
              currentPage: currentPage,
              totalPages: Math.ceil(totalProducts / itemsPerPage)
            };
          }
        } catch (error) {
          handleApiError(error);
          return { products: [], totalProducts: 0, currentPage: 1, totalPages: 1 };
        }
      }
      
      // Create a new product
      async function createProduct(productData) {
        try {
          try {
            const response = await fetch(`${API_URL}/products`, {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json'
              },
              body: JSON.stringify(productData)
            });
            
            if (!response.ok) throw new Error(`Server responded with status: ${response.status}`);
            
            const data = await response.json();
            return data.product;
          } catch (apiError) {
            console.error('API Error:', apiError);
            console.log('Falling back to localStorage for product creation');
            
            // Fallback to localStorage
            const products = JSON.parse(localStorage.getItem('shophub_products')) || [];
            const newProduct = {
              id: Date.now(), // Use timestamp as a simple ID
              ...productData,
              createdAt: new Date().toISOString(),
              updatedAt: new Date().toISOString()
            };
            
            products.push(newProduct);
            localStorage.setItem('shophub_products', JSON.stringify(products));
            
            return newProduct;
          }
        } catch (error) {
          handleApiError(error);
          return null;
        }
      }
      
      // Update an existing product
      async function updateProduct(id, productData) {
        try {
          try {
            const response = await fetch(`${API_URL}/products/${id}`, {
              method: 'PUT',
              headers: {
                'Content-Type': 'application/json'
              },
              body: JSON.stringify(productData)
            });
            
            if (!response.ok) throw new Error(`Server responded with status: ${response.status}`);
            
            const data = await response.json();
            return data.product;
          } catch (apiError) {
            console.error('API Error:', apiError);
            console.log('Falling back to localStorage for product update');
            
            // Fallback to localStorage
            const products = JSON.parse(localStorage.getItem('shophub_products')) || [];
            const index = products.findIndex(p => p.id === id || p._id === id);
            
            if (index !== -1) {
              const updatedProduct = {
                ...products[index],
                ...productData,
                updatedAt: new Date().toISOString()
              };
              
              products[index] = updatedProduct;
              localStorage.setItem('shophub_products', JSON.stringify(products));
              
              return updatedProduct;
            }
            return null;
          }
        } catch (error) {
          handleApiError(error);
          return null;
        }
      }
      
      // Delete a product
      async function deleteProduct(id) {
        try {
          try {
            const response = await fetch(`${API_URL}/products/${id}`, {
              method: 'DELETE'
            });
            
            if (!response.ok) throw new Error(`Server responded with status: ${response.status}`);
            
            return true;
          } catch (apiError) {
            console.error('API Error:', apiError);
            console.log('Falling back to localStorage for product deletion');
            
            // Fallback to localStorage
            let products = JSON.parse(localStorage.getItem('shophub_products')) || [];
            products = products.filter(p => p.id !== id && p._id !== id);
            localStorage.setItem('shophub_products', JSON.stringify(products));
            
            return true;
          }
        } catch (error) {
          handleApiError(error);
          return false;
        }
      }
      
      // Get a single product
      async function getProduct(id) {
        try {
          try {
            const response = await fetch(`${API_URL}/products/${id}`);
            if (!response.ok) throw new Error(`Server responded with status: ${response.status}`);
            
            const product = await response.json();
            return product;
          } catch (apiError) {
            console.error('API Error:', apiError);
            console.log('Falling back to localStorage for product retrieval');
            
            // Fallback to localStorage
            const products = JSON.parse(localStorage.getItem('shophub_products')) || [];
            return products.find(p => p.id === id || p._id === id) || null;
          }
        } catch (error) {
          handleApiError(error);
          return null;
        }
      }
      
      // Open the product modal for adding
      addProductBtn.addEventListener('click', function() {
        modalTitle.textContent = 'Add New Product';
        productForm.reset();
        productId.value = '';
        productStatus.value = 'active';
        productModal.style.display = 'block';
      });
      
      // Close modals
      function closeModals() {
        productModal.style.display = 'none';
        deleteModal.style.display = 'none';
      }
      
      closeModalBtn.addEventListener('click', closeModals);
      cancelProductBtn.addEventListener('click', closeModals);
      cancelDeleteBtn.addEventListener('click', closeModals);
      
      // Close modals when clicking outside
      window.addEventListener('click', function(event) {
        if (event.target === productModal) {
          productModal.style.display = 'none';
        }
        if (event.target === deleteModal) {
          deleteModal.style.display = 'none';
        }
      });
      
      // Submit product form
      productForm.addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const formData = {
          name: productName.value,
          sku: productSku.value,
          category: productCategory.value,
          price: parseFloat(productPrice.value),
          stock: parseInt(productStock.value),
          status: productStatus.value,
          image: productImage.value,
          description: productDescription.value
        };
        
        let success = false;
        
        if (productId.value) {
          // Update existing product
          const updatedProduct = await updateProduct(productId.value, formData);
          success = updatedProduct !== null;
        } else {
          // Add new product
          const newProduct = await createProduct(formData);
          success = newProduct !== null;
        }
        
        if (success) {
          renderProducts();
          closeModals();
        }
      });
      
      // Confirm delete product
      confirmDeleteBtn.addEventListener('click', async function() {
        if (selectedProductId) {
          const success = await deleteProduct(selectedProductId);
          if (success) {
            renderProducts();
            closeModals();
          }
        }
      });
      
      // Render products from API
      async function renderProducts() {
        const data = await fetchProducts();
        const { products, totalProducts, totalPages } = data;
        
        // Update counters and pagination buttons
        totalCount.textContent = totalProducts;
        showingCount.textContent = Math.min(totalProducts, products.length);
        
        prevPageBtn.disabled = currentPage === 1;
        nextPageBtn.disabled = currentPage === totalPages || totalPages === 0;
        
        // Show/hide no products message
        if (products.length === 0) {
          productsList.innerHTML = '';
          noProducts.classList.remove('hidden');
          return;
        } else {
          noProducts.classList.add('hidden');
        }
        
        // Clear the products list
        productsList.innerHTML = '';
        
        // Add products to the table
        products.forEach(product => {
          const row = document.createElement('tr');
          
          // Get product ID (handle both API _id and localStorage id)
          const productId = product._id || product.id;
          
          // Status badge class
          let statusClass = '';
          switch (product.status) {
            case 'active':
              statusClass = 'bg-green-100 text-green-800';
              break;
            case 'draft':
              statusClass = 'bg-gray-100 text-gray-800';
              break;
            case 'out-of-stock':
              statusClass = 'bg-red-100 text-red-800';
              break;
          }
          
          row.innerHTML = `
            <td class="px-4 py-4 whitespace-nowrap">
              <div class="flex items-center">
                <div class="flex-shrink-0 h-10 w-10">
                  <img class="h-10 w-10 rounded-full object-cover" src="${product.image}" alt="${product.name}">
                </div>
                <div class="ml-4">
                  <div class="text-sm font-medium text-gray-900">${product.name}</div>
                </div>
              </div>
            </td>
            <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-500">${product.sku || '-'}</td>
            <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-500">${product.category}</td>
            <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-500">${formatCurrency(product.price)}</td>
            <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-500">${product.stock}</td>
            <td class="px-4 py-4 whitespace-nowrap">
              <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${statusClass}">
                ${product.status}
              </span>
            </td>
            <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-500">
              <div class="flex space-x-2">
                <button class="edit-product text-blue-600 hover:text-blue-900" data-id="${productId}">
                  <i class="fas fa-edit"></i>
                </button>
                <button class="delete-product text-red-600 hover:text-red-900" data-id="${productId}">
                  <i class="fas fa-trash-alt"></i>
                </button>
              </div>
            </td>
          `;
          
          productsList.appendChild(row);
        });
        
        // Add event listeners to edit and delete buttons
        const editButtons = document.querySelectorAll('.edit-product');
        const deleteButtons = document.querySelectorAll('.delete-product');
        
        editButtons.forEach(button => {
          button.addEventListener('click', function() {
            const id = this.dataset.id;
            editProduct(id);
          });
        });
        
        deleteButtons.forEach(button => {
          button.addEventListener('click', function() {
            const id = this.dataset.id;
            openDeleteModal(id);
          });
        });
      }
      
      // Edit a product
      async function editProduct(id) {
        const product = await getProduct(id);
        if (!product) return;
        
        productId.value = product._id;
        productName.value = product.name;
        productSku.value = product.sku || '';
        productPrice.value = product.price;
        productCategory.value = product.category;
        productStock.value = product.stock;
        productStatus.value = product.status;
        productImage.value = product.image;
        productDescription.value = product.description || '';
        
        modalTitle.textContent = 'Edit Product';
        productModal.style.display = 'block';
      }
      
      // Open delete confirmation modal
      function openDeleteModal(id) {
        selectedProductId = id;
        deleteModal.style.display = 'block';
      }
      
      // Pagination event listeners
      prevPageBtn.addEventListener('click', function() {
        if (currentPage > 1) {
          currentPage--;
          renderProducts();
        }
      });
      
      nextPageBtn.addEventListener('click', function() {
        currentPage++;
        renderProducts();
      });
      
      // Filter and search event listeners
      searchInput.addEventListener('input', debounce(function() {
        currentPage = 1;
        renderProducts();
      }, 500));
      
      categoryFilter.addEventListener('change', function() {
        currentPage = 1;
        renderProducts();
      });
      
      sortSelect.addEventListener('change', function() {
        renderProducts();
      });
      
      // Debounce function for search
      function debounce(func, delay) {
        let timeout;
        return function() {
          const context = this;
          const args = arguments;
          clearTimeout(timeout);
          timeout = setTimeout(() => func.apply(context, args), delay);
        }
      }
      
      // Sign Out Button Functionality
      const signOutButton = document.getElementById('signOutButton');
      
      signOutButton.addEventListener('click', function() {
        // In a real app, you would perform logout operations here
        window.location.href = 'login.html';
      });
      
      // Initial render
      renderProducts();
      
      // Check API connection and set up status indicator
      const connectionStatus = document.getElementById('connection-status');
      
      async function checkApiConnection() {
        try {
          const response = await fetch(`${API_URL}/products?limit=1`);
          if (response.ok) {
            connectionStatus.textContent = 'API Connected';
            connectionStatus.classList.remove('hidden', 'bg-red-100', 'text-red-800');
            connectionStatus.classList.add('bg-green-100', 'text-green-800');
            return true;
          } else {
            throw new Error('API connection failed');
          }
        } catch (error) {
          console.error('API Connection Error:', error);
          connectionStatus.textContent = 'Using Local Storage';
          connectionStatus.classList.remove('hidden', 'bg-green-100', 'text-green-800');
          connectionStatus.classList.add('bg-yellow-100', 'text-yellow-800');
          
          // Initialize localStorage with sample products if empty
          const products = JSON.parse(localStorage.getItem('shophub_products')) || [];
          if (products.length === 0) {
            const sampleProducts = [
              {
                id: 1,
                name: 'Bluetooth Headphones',
                sku: 'BT-HP-001',
                category: 'electronics',
                price: 79.99,
                stock: 58,
                status: 'active',
                image: 'https://images.unsplash.com/photo-1505740420928-5e560c06d30e?ixlib=rb-1.2.1&auto=format&fit=crop&w=800&q=80',
                description: 'Wireless Bluetooth headphones with noise cancelling technology and premium sound quality.',
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString()
              },
              {
                id: 2,
                name: 'Premium Cotton T-Shirt',
                sku: 'CT-TS-002',
                category: 'clothing',
                price: 24.99,
                stock: 120,
                status: 'active',
                image: 'https://images.unsplash.com/photo-1521572163474-6864f9cf17ab?ixlib=rb-1.2.1&auto=format&fit=crop&w=800&q=80',
                description: 'Premium quality cotton t-shirt, comfortable fit, and multiple colors available.',
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString()
              },
              {
                id: 3,
                name: 'Smart LED TV',
                sku: 'SM-TV-003',
                category: 'electronics',
                price: 549.99,
                stock: 15,
                status: 'active',
                image: 'https://images.unsplash.com/photo-1593784991095-a205069470b6?ixlib=rb-1.2.1&auto=format&fit=crop&w=800&q=80',
                description: '50-inch 4K Ultra HD Smart LED TV with built-in streaming apps and voice control.',
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString()
              },
              {
                id: 4,
                name: 'Kitchen Blender',
                sku: 'KB-MX-004',
                category: 'home',
                price: 129.99,
                stock: 32,
                status: 'active',
                image: 'https://images.unsplash.com/photo-1570222094114-d054a817e56b?ixlib=rb-1.2.1&auto=format&fit=crop&w=800&q=80',
                description: 'High-performance kitchen blender with multiple speed settings and a sturdy design.',
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString()
              },
              {
                id: 5,
                name: 'Facial Cleanser',
                sku: 'FC-SR-005',
                category: 'beauty',
                price: 18.99,
                stock: 85,
                status: 'active',
                image: 'https://images.unsplash.com/photo-1556228841-a3c527ebefe5?ixlib=rb-1.2.1&auto=format&fit=crop&w=800&q=80',
                description: 'Gentle facial cleanser suitable for all skin types, removes makeup and impurities.',
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString()
              },
              {
                id: 6,
                name: 'Yoga Mat',
                sku: 'YG-MT-006',
                category: 'sports',
                price: 35.99,
                stock: 0,
                status: 'out-of-stock',
                image: 'https://images.unsplash.com/photo-1592432678016-e910b452f9a2?ixlib=rb-1.2.1&auto=format&fit=crop&w=800&q=80',
                description: 'Eco-friendly non-slip yoga mat, perfect for home or studio practice.',
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString()
              }
            ];
            localStorage.setItem('shophub_products', JSON.stringify(sampleProducts));
          }
          return false;
        }
      }
      
      // Check connection on load
      checkApiConnection();
      
      // Re-check connection periodically
      setInterval(checkApiConnection, 30000); // Check every 30 seconds
    });
  </script>
</body>
</html> 